# System Architecture Overview

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         END USERS                                â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Customer   â”‚  â”‚    Admin     â”‚  â”‚  Embedded    â”‚         â”‚
â”‚  â”‚     Chat     â”‚  â”‚  Dashboard   â”‚  â”‚   Widget     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                  â”‚                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                  â”‚                  â”‚
          â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
          â”‚       â”‚                     â”‚      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â–º   FRONTEND LAYER    â—„â”€â”€â”€â”€â”€â”€â”˜
                  â”‚  (HTML/CSS/JS)      â”‚
                  â”‚                     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    REST API / WebSocket
                             â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                      â”‚
          â”‚        BACKEND API LAYER             â”‚
          â”‚         (Flask + Python)             â”‚
          â”‚                                      â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
          â”‚  â”‚     Authentication         â”‚    â”‚
          â”‚  â”‚  (JWT, API Keys)           â”‚    â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
          â”‚                                      â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
          â”‚  â”‚    Business Logic          â”‚    â”‚
          â”‚  â”‚  (Services Layer)          â”‚    â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
          â”‚                                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
    â”‚   AI/ML    â”‚        â”‚  Database  â”‚
    â”‚   Layer    â”‚        â”‚   Layer    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Detailed Component Architecture

### 1. Frontend Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    FRONTEND                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Public Pages                         â”‚      â”‚
â”‚  â”‚  â€¢ Landing page (index.html)                 â”‚      â”‚
â”‚  â”‚  â€¢ Pricing (pricing.html)                    â”‚      â”‚
â”‚  â”‚  â€¢ Login/Signup (auth.html)                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚      Protected Dashboard                     â”‚      â”‚
â”‚  â”‚  â€¢ Overview (dashboard.html)                 â”‚      â”‚
â”‚  â”‚  â€¢ Conversations (conversations.html)        â”‚      â”‚
â”‚  â”‚  â€¢ Documents (documents.html)                â”‚      â”‚
â”‚  â”‚  â€¢ Analytics (analytics.html)                â”‚      â”‚
â”‚  â”‚  â€¢ Settings (settings.html)                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚      Embeddable Widget                       â”‚      â”‚
â”‚  â”‚  â€¢ chat-widget.js (main)                     â”‚      â”‚
â”‚  â”‚  â€¢ widget.css (styling)                      â”‚      â”‚
â”‚  â”‚  â€¢ WebSocket client                          â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚         Shared Components                    â”‚      â”‚
â”‚  â”‚  â€¢ API client (api.js)                       â”‚      â”‚
â”‚  â”‚  â€¢ Auth manager (auth.js)                    â”‚      â”‚
â”‚  â”‚  â€¢ Utilities (utils.js)                      â”‚      â”‚
â”‚  â”‚  â€¢ Chart library (Chart.js)                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Backend API Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BACKEND (Flask)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  app/                                                    â”‚
â”‚  â”‚                                                       â”‚
â”‚  â”œâ”€â”€ api/ (Routes/Endpoints)                           â”‚
â”‚  â”‚   â”œâ”€â”€ auth.py           # POST /api/auth/login      â”‚
â”‚  â”‚   â”œâ”€â”€ chat.py           # WS   /api/chat/ws         â”‚
â”‚  â”‚   â”œâ”€â”€ admin.py          # GET  /api/admin/stats     â”‚
â”‚  â”‚   â”œâ”€â”€ documents.py      # POST /api/documents       â”‚
â”‚  â”‚   â”œâ”€â”€ payments.py       # POST /api/payments/webhookâ”‚
â”‚  â”‚   â””â”€â”€ analytics.py      # GET  /api/analytics       â”‚
â”‚  â”‚                                                       â”‚
â”‚  â”œâ”€â”€ services/ (Business Logic)                        â”‚
â”‚  â”‚   â”œâ”€â”€ embedding_service.py    # OpenAI embeddings  â”‚
â”‚  â”‚   â”œâ”€â”€ vector_store_service.py # ChromaDB ops       â”‚
â”‚  â”‚   â”œâ”€â”€ sentiment_service.py    # Sentiment analysis â”‚
â”‚  â”‚   â”œâ”€â”€ chat_service.py         # RAG + LLM          â”‚
â”‚  â”‚   â”œâ”€â”€ auth_service.py         # Auth logic         â”‚
â”‚  â”‚   â”œâ”€â”€ ticket_service.py       # Ticket management  â”‚
â”‚  â”‚   â””â”€â”€ payment_service.py      # Stripe integration â”‚
â”‚  â”‚                                                       â”‚
â”‚  â”œâ”€â”€ models/ (Database Models)                         â”‚
â”‚  â”‚   â”œâ”€â”€ user.py                  # User table         â”‚
â”‚  â”‚   â”œâ”€â”€ organization.py          # Org table          â”‚
â”‚  â”‚   â”œâ”€â”€ conversation.py          # Conversation table â”‚
â”‚  â”‚   â”œâ”€â”€ message.py               # Message table      â”‚
â”‚  â”‚   â”œâ”€â”€ ticket.py                # Ticket table       â”‚
â”‚  â”‚   â””â”€â”€ subscription.py          # Subscription table â”‚
â”‚  â”‚                                                       â”‚
â”‚  â””â”€â”€ utils/ (Helper Functions)                         â”‚
â”‚      â”œâ”€â”€ jwt_helper.py            # Token management   â”‚
â”‚      â”œâ”€â”€ validators.py            # Input validation   â”‚
â”‚      â””â”€â”€ rate_limiter.py          # Rate limiting      â”‚
â”‚                                                          â”‚
â”‚  config.py               # Configuration                â”‚
â”‚  run.py                  # Application entry            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. AI/ML Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AI/ML PIPELINE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Step 1: User Message Arrives                          â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€â”€â–º Sentiment Analysis                            â”‚
â”‚     â”‚    (transformers)                                 â”‚
â”‚     â”‚    â†’ Detect emotion                               â”‚
â”‚     â”‚    â†’ Calculate priority                           â”‚
â”‚     â”‚    â†’ Flag escalation                              â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€â”€â–º Generate Embedding                             â”‚
â”‚     â”‚    (OpenAI text-embedding-3-small)                â”‚
â”‚     â”‚    â†’ Convert to 1536-dim vector                   â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€â”€â–º Vector Search                                  â”‚
â”‚          (ChromaDB)                                      â”‚
â”‚          â†’ Find relevant documents                       â”‚
â”‚          â†’ Rank by similarity                            â”‚
â”‚          â†’ Return top 3 contexts                         â”‚
â”‚                                                          â”‚
â”‚  Step 2: Context Preparation                           â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€â”€â–º Retrieve Conversation History                 â”‚
â”‚     â”‚    (Last 5 messages)                              â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€â”€â–º Combine:                                       â”‚
â”‚          â€¢ Retrieved documents                           â”‚
â”‚          â€¢ Conversation history                          â”‚
â”‚          â€¢ User message                                  â”‚
â”‚          â€¢ System prompt                                 â”‚
â”‚                                                          â”‚
â”‚  Step 3: LLM Generation                                â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€â”€â–º LangChain RAG Chain                           â”‚
â”‚          (GPT-4-turbo or GPT-3.5-turbo)                â”‚
â”‚          â†’ Generate contextual response                  â”‚
â”‚          â†’ Cite sources                                  â”‚
â”‚          â†’ Handle edge cases                             â”‚
â”‚                                                          â”‚
â”‚  Step 4: Post-Processing                               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€â”€â–º Quality Check                                  â”‚
â”‚     â”‚    â†’ Validate response                            â”‚
â”‚     â”‚    â†’ Check for hallucinations                     â”‚
â”‚     â”‚                                                    â”‚
â”‚     â”œâ”€â”€â–º Format Response                                â”‚
â”‚     â”‚    â†’ Add citations                                â”‚
â”‚     â”‚    â†’ Apply markdown                               â”‚
â”‚     â”‚                                                    â”‚
â”‚     â””â”€â”€â–º Log & Store                                    â”‚
â”‚          â†’ Save to database                              â”‚
â”‚          â†’ Update analytics                              â”‚
â”‚                                                          â”‚
â”‚  Step 5: Return to User                                â”‚
â”‚     Response with metadata                               â”‚
â”‚     â€¢ Message text                                       â”‚
â”‚     â€¢ Sentiment score                                    â”‚
â”‚     â€¢ Confidence level                                   â”‚
â”‚     â€¢ Suggested actions                                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4. Database Layer

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  DATABASE SCHEMA                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  SQLite (Dev) / PostgreSQL (Prod)                      â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  organizations   â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚ id               â”‚                                   â”‚
â”‚  â”‚ name             â”‚                                   â”‚
â”‚  â”‚ api_key          â”‚                                   â”‚
â”‚  â”‚ created_at       â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚           â”‚ 1                                            â”‚
â”‚           â”‚                                              â”‚
â”‚           â”‚ *                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  users           â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚ id               â”‚                                   â”‚
â”‚  â”‚ email            â”‚                                   â”‚
â”‚  â”‚ password_hash    â”‚                                   â”‚
â”‚  â”‚ organization_id  â”‚â—„â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚ role             â”‚       â”‚                           â”‚
â”‚  â”‚ created_at       â”‚       â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚                           â”‚
â”‚           â”‚ 1                â”‚                           â”‚
â”‚           â”‚                  â”‚                           â”‚
â”‚           â”‚ *                â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚                           â”‚
â”‚  â”‚  conversations   â”‚       â”‚                           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚                           â”‚
â”‚  â”‚ id               â”‚       â”‚                           â”‚
â”‚  â”‚ organization_id  â”‚â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚  â”‚ customer_email   â”‚                                   â”‚
â”‚  â”‚ status           â”‚                                   â”‚
â”‚  â”‚ priority         â”‚                                   â”‚
â”‚  â”‚ created_at       â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚           â”‚ 1                                            â”‚
â”‚           â”‚                                              â”‚
â”‚           â”‚ *                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  messages        â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚ id               â”‚                                   â”‚
â”‚  â”‚ conversation_id  â”‚                                   â”‚
â”‚  â”‚ content          â”‚                                   â”‚
â”‚  â”‚ role (user/ai)   â”‚                                   â”‚
â”‚  â”‚ sentiment_score  â”‚                                   â”‚
â”‚  â”‚ created_at       â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  tickets         â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚ id               â”‚                                   â”‚
â”‚  â”‚ conversation_id  â”‚                                   â”‚
â”‚  â”‚ category         â”‚                                   â”‚
â”‚  â”‚ status           â”‚                                   â”‚
â”‚  â”‚ assigned_to      â”‚                                   â”‚
â”‚  â”‚ created_at       â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  documents       â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚ id               â”‚                                   â”‚
â”‚  â”‚ organization_id  â”‚                                   â”‚
â”‚  â”‚ title            â”‚                                   â”‚
â”‚  â”‚ content          â”‚                                   â”‚
â”‚  â”‚ category         â”‚                                   â”‚
â”‚  â”‚ vector_id        â”‚ (Reference to ChromaDB)           â”‚
â”‚  â”‚ created_at       â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚  subscriptions   â”‚                                   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                                   â”‚
â”‚  â”‚ id               â”‚                                   â”‚
â”‚  â”‚ organization_id  â”‚                                   â”‚
â”‚  â”‚ stripe_sub_id    â”‚                                   â”‚
â”‚  â”‚ plan_tier        â”‚                                   â”‚
â”‚  â”‚ status           â”‚                                   â”‚
â”‚  â”‚ current_period   â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             VECTOR DATABASE (ChromaDB)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Collections (One per organization):                    â”‚
â”‚                                                          â”‚
â”‚  org_123_docs                                           â”‚
â”‚  â”œâ”€â”€ Document embeddings (1536 dims)                    â”‚
â”‚  â”œâ”€â”€ Document content                                   â”‚
â”‚  â””â”€â”€ Metadata (title, category, source)                â”‚
â”‚                                                          â”‚
â”‚  org_456_docs                                           â”‚
â”‚  â”œâ”€â”€ Document embeddings                                â”‚
â”‚  â”œâ”€â”€ Document content                                   â”‚
â”‚  â””â”€â”€ Metadata                                           â”‚
â”‚                                                          â”‚
â”‚  (Isolated per organization for security)              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 5. External Services Integration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              EXTERNAL SERVICES                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  OpenAI API                                             â”‚
â”‚  â”œâ”€â”€ text-embedding-3-small (Embeddings)               â”‚
â”‚  â”œâ”€â”€ gpt-4-turbo-preview (Main chat)                   â”‚
â”‚  â””â”€â”€ gpt-3.5-turbo (Fallback/cost savings)             â”‚
â”‚                                                          â”‚
â”‚  Stripe                                                 â”‚
â”‚  â”œâ”€â”€ Checkout Sessions                                  â”‚
â”‚  â”œâ”€â”€ Subscriptions                                      â”‚
â”‚  â”œâ”€â”€ Webhooks                                           â”‚
â”‚  â””â”€â”€ Customer Portal                                    â”‚
â”‚                                                          â”‚
â”‚  SendGrid/Postmark (Email)                             â”‚
â”‚  â”œâ”€â”€ Welcome emails                                     â”‚
â”‚  â”œâ”€â”€ Password reset                                     â”‚
â”‚  â”œâ”€â”€ Notifications                                      â”‚
â”‚  â””â”€â”€ Billing updates                                    â”‚
â”‚                                                          â”‚
â”‚  Sentry (Monitoring)                                    â”‚
â”‚  â”œâ”€â”€ Error tracking                                     â”‚
â”‚  â”œâ”€â”€ Performance monitoring                             â”‚
â”‚  â””â”€â”€ Alerts                                             â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Examples

### Example 1: Customer Asks Question

```
Customer: "How do I reset my password?"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Frontend Widget                    â”‚
â”‚    â€¢ Capture input                    â”‚
â”‚    â€¢ Send via WebSocket               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Backend Receives Message           â”‚
â”‚    â€¢ Validate input                   â”‚
â”‚    â€¢ Check rate limits                â”‚
â”‚    â€¢ Authenticate organization        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Sentiment Analysis                 â”‚
â”‚    Input: "How do I reset my password?"â”‚
â”‚    Output: {                          â”‚
â”‚      label: "NEUTRAL",                â”‚
â”‚      score: 0.65,                     â”‚
â”‚      priority: "MEDIUM"               â”‚
â”‚    }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Generate Embedding                 â”‚
â”‚    Input: "How do I reset my password?"â”‚
â”‚    Output: [0.234, -0.123, ..., 0.456]â”‚
â”‚    (1536 dimensions)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Vector Search (ChromaDB)           â”‚
â”‚    Query: [0.234, -0.123, ..., 0.456] â”‚
â”‚    Results:                           â”‚
â”‚      1. "Password Reset Guide" (0.91) â”‚
â”‚      2. "Account Settings" (0.73)     â”‚
â”‚      3. "Security FAQ" (0.68)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Prepare Context                    â”‚
â”‚    Context = {                        â”‚
â”‚      retrieved_docs: [...],           â”‚
â”‚      conversation_history: [...],     â”‚
â”‚      user_message: "How do I...",     â”‚
â”‚      system_prompt: "You are..."      â”‚
â”‚    }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. LLM Generation (GPT-4)             â”‚
â”‚    Prompt: [Full context]             â”‚
â”‚    Response: "To reset your password, â”‚
â”‚    go to the login page and click     â”‚
â”‚    'Forgot Password'..."              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. Store & Return                     â”‚
â”‚    â€¢ Save to database                 â”‚
â”‚    â€¢ Update analytics                 â”‚
â”‚    â€¢ Send via WebSocket               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. Customer Sees Response             â”‚
â”‚    "To reset your password, go to..." â”‚
â”‚    [Helpful] [Not Helpful]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Time: 1-2 seconds
```

---

### Example 2: Admin Uploads Document

```
Admin: Uploads "Product Guide v2.pdf"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Upload via Dashboard               â”‚
â”‚    â€¢ File validation                  â”‚
â”‚    â€¢ Size check                       â”‚
â”‚    â€¢ Type verification                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Extract Text                       â”‚
â”‚    â€¢ Use pypdf library                â”‚
â”‚    â€¢ Clean text                       â”‚
â”‚    â€¢ Split into chunks                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Generate Embeddings (Batch)        â”‚
â”‚    Chunks: 15                         â”‚
â”‚    Embeddings: 15 vectors             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Store in ChromaDB                  â”‚
â”‚    Collection: org_123_docs           â”‚
â”‚    Documents: 15 chunks               â”‚
â”‚    Metadata: {                        â”‚
â”‚      title: "Product Guide v2",       â”‚
â”‚      category: "product",             â”‚
â”‚      source: "pdf"                    â”‚
â”‚    }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Store Reference in Database        â”‚
â”‚    documents table:                   â”‚
â”‚    â€¢ id: doc_789                      â”‚
â”‚    â€¢ title: "Product Guide v2"        â”‚
â”‚    â€¢ organization_id: org_123         â”‚
â”‚    â€¢ vector_ids: [...]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Success Message                    â”‚
â”‚    "Document uploaded successfully!"  â”‚
â”‚    Now available for chatbot queries  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Example 3: Subscription Payment

```
Customer: Clicks "Subscribe to Pro"
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Stripe Checkout                    â”‚
â”‚    â€¢ Create checkout session          â”‚
â”‚    â€¢ Redirect to Stripe               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Customer Pays                      â”‚
â”‚    â€¢ Enters card details              â”‚
â”‚    â€¢ Stripe processes                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Stripe Webhook                     â”‚
â”‚    Event: checkout.session.completed  â”‚
â”‚    Data: {                            â”‚
â”‚      customer_id: cus_123,            â”‚
â”‚      subscription_id: sub_456,        â”‚
â”‚      status: "active"                 â”‚
â”‚    }                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Backend Processes Webhook          â”‚
â”‚    â€¢ Verify signature                 â”‚
â”‚    â€¢ Update database                  â”‚
â”‚    â€¢ Activate subscription            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Send Confirmation Email            â”‚
â”‚    "Welcome to Pro! ğŸ‰"               â”‚
â”‚    â€¢ Receipt                          â”‚
â”‚    â€¢ Getting started guide            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. Redirect to Dashboard              â”‚
â”‚    â€¢ Show Pro features                â”‚
â”‚    â€¢ Update UI                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SECURITY LAYERS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Layer 1: Network                                       â”‚
â”‚  â”œâ”€â”€ HTTPS/TLS encryption                              â”‚
â”‚  â”œâ”€â”€ CORS policies                                      â”‚
â”‚  â””â”€â”€ DDoS protection (via Cloudflare)                  â”‚
â”‚                                                          â”‚
â”‚  Layer 2: Authentication                                â”‚
â”‚  â”œâ”€â”€ JWT tokens (15 min expiry)                        â”‚
â”‚  â”œâ”€â”€ Refresh tokens (7 days)                           â”‚
â”‚  â”œâ”€â”€ API keys (for widget)                             â”‚
â”‚  â””â”€â”€ Password hashing (bcrypt)                         â”‚
â”‚                                                          â”‚
â”‚  Layer 3: Authorization                                 â”‚
â”‚  â”œâ”€â”€ Role-based access control                         â”‚
â”‚  â”œâ”€â”€ Organization isolation                            â”‚
â”‚  â”œâ”€â”€ Resource ownership checks                          â”‚
â”‚  â””â”€â”€ Rate limiting per user/org                        â”‚
â”‚                                                          â”‚
â”‚  Layer 4: Data                                          â”‚
â”‚  â”œâ”€â”€ Encrypted at rest (database)                      â”‚
â”‚  â”œâ”€â”€ Encrypted in transit (TLS)                        â”‚
â”‚  â”œâ”€â”€ Isolated vector stores                            â”‚
â”‚  â””â”€â”€ Regular backups                                    â”‚
â”‚                                                          â”‚
â”‚  Layer 5: Application                                   â”‚
â”‚  â”œâ”€â”€ Input validation                                   â”‚
â”‚  â”œâ”€â”€ SQL injection prevention                          â”‚
â”‚  â”œâ”€â”€ XSS protection                                     â”‚
â”‚  â”œâ”€â”€ CSRF tokens                                        â”‚
â”‚  â””â”€â”€ Error message sanitization                        â”‚
â”‚                                                          â”‚
â”‚  Layer 6: Monitoring                                    â”‚
â”‚  â”œâ”€â”€ Error tracking (Sentry)                           â”‚
â”‚  â”œâ”€â”€ Access logs                                        â”‚
â”‚  â”œâ”€â”€ Anomaly detection                                  â”‚
â”‚  â””â”€â”€ Security alerts                                    â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Scalability Considerations

### Current Architecture (MVP - 100 users)
- Single server (Render)
- SQLite/PostgreSQL
- ChromaDB local instance

### Growth Phase (1,000 users)
- Load balancer
- Multiple app instances
- Managed PostgreSQL
- Redis caching
- ChromaDB with persistent storage

### Scale Phase (10,000+ users)
- Kubernetes cluster
- Database replicas
- Microservices (optional)
- CDN for static assets
- Message queue (Celery/RabbitMQ)

---

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRODUCTION                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Vercel/Netlify (Frontend)                 â”‚        â”‚
â”‚  â”‚  â€¢ Global CDN                              â”‚        â”‚
â”‚  â”‚  â€¢ Automatic scaling                        â”‚        â”‚
â”‚  â”‚  â€¢ SSL certificates                         â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                      â”‚
â”‚                   â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Render (Backend)                          â”‚        â”‚
â”‚  â”‚  â€¢ Docker containers                        â”‚        â”‚
â”‚  â”‚  â€¢ Auto-deploy from git                     â”‚        â”‚
â”‚  â”‚  â€¢ Environment variables                    â”‚        â”‚
â”‚  â”‚  â€¢ Health checks                            â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                   â”‚                                      â”‚
â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚                   â–¼             â–¼              â–¼        â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚          â”‚ PostgreSQL  â”‚  â”‚ ChromaDB â”‚  â”‚  Redis   â”‚  â”‚
â”‚          â”‚  (Managed)  â”‚  â”‚  (Data)  â”‚  â”‚ (Cache)  â”‚  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Monitoring                                â”‚        â”‚
â”‚  â”‚  â€¢ Sentry (Errors)                         â”‚        â”‚
â”‚  â”‚  â€¢ Datadog/NewRelic (Performance)          â”‚        â”‚
â”‚  â”‚  â€¢ Uptime monitoring                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technology Justification

| Tech | Why? | Alternatives |
|------|------|--------------|
| Flask | Lightweight, Python, great for APIs | FastAPI, Django |
| Vanilla JS | No build step, fast loading | React, Vue |
| ChromaDB | Easy setup, Python native | Pinecone, Weaviate |
| SQLiteâ†’PostgreSQL | Simple dev, powerful prod | MySQL, MongoDB |
| OpenAI | Best-in-class LLMs | Anthropic Claude, local models |
| Stripe | Industry standard payments | PayPal, Paddle |
| Render | Easy deployment, good free tier | Heroku, AWS, GCP |

---

This architecture is designed to:
- âœ… Start simple (MVP)
- âœ… Scale gradually
- âœ… Keep costs low initially
- âœ… Be maintainable by one developer
- âœ… Follow industry best practices

Ready to build? Start with `docs/PHASE_2_GUIDE.md`! ğŸš€
